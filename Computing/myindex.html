<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,shrink-to-fit=no">
    <title>Title</title>
    <link rel="stylesheet" type="text/css" href="BootStrap/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/demo.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="shortcut icon" type="images/x-icon" href="Images/github.png">
</head>
<body>
<div class="container">
    <label class="switch">
        <input type="checkbox">
        <span class="slider"></span>
    </label>
    <form>
        <input readonly id="display1" type="text" class="form-control-lg text-right">
        <input readonly id="display2" type="text" class="form-control-lg text-right">
    </form>


    <div class="d-flex justify-content-between button-row">
        <button id="left-parenthesis" type="button" class="operator-group">&#40;</button>
        <button id="right-parenthesis" type="button" class="operator-group">&#41;</button>
        <button id="square-root" type="button" class="operator-group">&#8730;</button>
        <button id="square" type="button" class="operator-group">&#120;&#178;</button>
    </div>

    <div class="d-flex justify-content-between button-row">
        <button id="clear" type="button">&#67;</button>
        <button id="backspace" type="button">&#8592;</button>
        <button id="ans" type="button" class="operand-group">&#65;&#110;&#115;</button>
        <button id="divide" type="button" class="operator-group" >&#247;</button>
    </div>

    <div class="d-flex justify-content-between button-row">
        <button id="seven" type="button" class="operand-group">&#55;</button>
        <button id="eight" type="button" class="operand-group">&#56;</button>
        <button id="nine" type="button" class="operand-group">&#57;</button>
        <button id="multiply" type="button" class="operator-group">&#215;</button>
    </div>

    <div class="d-flex justify-content-between button-row">
        <button id="four" type="button" class="operand-group">&#52;</button>
        <button id="five" type="button" class="operand-group">&#53;</button>
        <button id="six" type="button" class="operand-group">&#54;</button>
        <button id="subtract" type="button" class="operator-group">&#8722;</button>
    </div>

    <div class="d-flex justify-content-between button-row">
        <button id="one" type="button" class="operand-group">&#49;</button>
        <button id="two" type="button" class="operand-group">&#50;</button>
        <button id="three" type="button" class="operand-group">&#51;</button>
        <button id="add" type="button" class="operator-group">&#43;</button>
    </div>

    <div class="d-flex justify-content-between button-row">
        <button id="percentage" type="button" class="operand-group">&#37;</button>
        <button id="zero" type="button" class="operand-group">&#48;</button>
        <button id="decimal" type="button" class="operand-group">&#46;</button>
        <button id="equal" type="button">&#61;</button>
    </div>
</div>
<script src="js/jquery-1.11.0.min.js"></script>

<script src="js/math.min.js"></script>
<script>
    'use strict'
    var display1={
        operation:"",
        evaluation:"",
        answer:""
    };

    var flag={
        ansAllowed:false
    };

    $("#display1").val("");
    $("#display2").val("");

    $(".container").addClass("container-light");
    $("form").addClass("form-light");
    $("form input").addClass("form-input-light");

    $(".operand-group").addClass("operand-group-light");
    $(".operator-group").addClass("operator-group-light");

    $("#equal").addClass("equal-light");
    $("#clear").addClass("clear-light");
    $("#backspace").addClass("backspace-light");


    function evaluate() {
        try{
            math.eval(display1.operation);
            display1.evaluation=math.eval(display1.operation);
            return true;
        }catch(e){
            if(e instanceof  SyntaxError){
                display1.evaluation="E";
                return false;
            }else {
                display1.evaluation="UE";
                return false;
            }
        }

    }

    $("#zero").on('click',function () {
        display1.operation=display1.operation+"0";
        $("#display1").val($("#display1").val()+'' +
                '0');
        evaluate();
        $("#display2").val(display1.evaluation);

    });

    $("#one").on('click',function () {
        display1.operation=display1.operation+"1";
        $("#display1").val($("#display1").val()+'' +
                '1');
        evaluate();
        $("#display2").val(display1.evaluation);

    });

    $("#two").on('click',function () {
        display1.operation=display1.operation+"2";
        $("#display1").val($("#display1").val()+'' +
                '2');
        evaluate();
        $("#display2").val(display1.evaluation);

    });
    $("#three").on('click',function () {
        display1.operation=display1.operation+"3";
        $("#display1").val($("#display1").val()+'' +
                '3');
        evaluate();
        $("#display2").val(display1.evaluation);

    });

    $("#four").on('click',function () {
        display1.operation=display1.operation+"4";
        $("#display1").val($("#display1").val()+'' +
                '4');
        evaluate();
        $("#display2").val(display1.evaluation);

    });

    $("#five").on('click',function () {
        display1.operation=display1.operation+"5";
        $("#display1").val($("#display1").val()+'' +
                '5');
        evaluate();
        $("#display2").val(display1.evaluation);

    });

    $("#six").on('click',function () {
        display1.operation=display1.operation+"6";
        $("#display1").val($("#display1").val()+'' +
                '6');
        evaluate();
        $("#display2").val(display1.evaluation);

    });

    $("#seven").on('click',function () {
        display1.operation=display1.operation+"7";
        $("#display1").val($("#display1").val()+'' +
                '7');
        evaluate();
        $("#display2").val(display1.evaluation);

    });

    $("#eight").on('click',function () {
        display1.operation=display1.operation+"8";
        $("#display1").val($("#display1").val()+'' +
                '8');
        evaluate();
        $("#display2").val(display1.evaluation);

    });

    $("#nine").on('click',function () {
        display1.operation=display1.operation+"9";
        $("#display1").val($("#display1").val()+'' +
                '9');
        evaluate();
        $("#display2").val(display1.evaluation);

    });

    $(" #decimal").on('click',function () {
        display1.operation=display1.operation+".";
        $("#display1").val($("#display1").val()+'\u002e');
        evaluate();
        $("#display2").val(display1.evaluation);
    });

    $('#left-parenthesis').on('click', function () {
        display1.operation = display1.operation + "(";
        $('#display1').val($('#display1').val() + '\u0028');
        evaluate();
        $('#display2').val(display1.evaluation);
    });

    $('#right-parenthesis').on('click', function () {
        display1.operation = display1.operation + ")";
        $('#display1').val($('#display1').val() + '\u0029');
        evaluate();
        $('#display2').val(display1.evaluation);
    });

    $('#add').on('click', function () {
        display1.operation = display1.operation + "+";
        $('#display1').val($('#display1').val() + '\u002b');
        evaluate();
        $('#display2').val(display1.evaluation);
    });

    $('#subtract').on('click', function () {
        display1.operation = display1.operation + "-";
        $('#display1').val($('#display1').val() + '\u2212');
        evaluate();
        $('#display2').val(display1.evaluation);
    })

    $('#multiply').on('click', function () {
        display1.operation = display1.operation + "*";
        $('#display1').val($('#display1').val() + '\u00d7');
        evaluate();
        $('#display2').val(display1.evaluation);
    });

    $('#divide').on('click', function () {
        display1.operation = display1.operation + "/";
        $('#display1').val($('#display1').val() + '\u00f7');
        evaluate();
        $('#display2').val(display1.evaluation);
    });


    $("#square-root").on('click',function () {
        var count=0;
        var index=-1;
        var radicand="";
        var result="";

        if(display1.operation.endsWith(')')){
            for(var i=display1.operation.length-2;i>-1;i--){
                if(display1.operation.charAt(i)=='('){
                    if(count==0){
                        index=i;
                        break;
                    }else {
                        count-=1;
                        continue;
                    }
                }else if(display1.operation.charAt(i)==')'){
                    count+=1;
                }else {
                    continue;
                }
            }
            if(index==-1){
                $('#display2').val('Malformed expression');
                return;
            }

        }else if(display1.operation.endsWith('0')||display1.operation.endsWith('1')||
                 display1.operation.endsWith('2')||display1.operation.endsWith('3')||
                 display1.operation.endsWith('4')||display1.operation.endsWith('5')||
                 display1.operation.endsWith('6')||display1.operation.endsWith('7')||
                 display1.operation.endsWith('8')||display1.operation.endsWith('9')||
                 display1.operation.endsWith('.'))
        {
            index=display1.operation.length-1;
            for(var i=display1.operation.length-2;i>-1;i--){
                if(
                        display1.operation.charAt(i)=='0'||display1.operation.charAt(i)=='1'||
                        display1.operation.charAt(i)=='2'||display1.operation.charAt(i)=='3'||
                        display1.operation.charAt(i)=='4'||display1.operation.charAt(i)=='5'||
                        display1.operation.charAt(i)=='6'||display1.operation.charAt(i)=='7'||
                        display1.operation.charAt(i)=='8'||display1.operation.charAt(i)=='9'||
                        display1.operation.charAt(i)=='.'|| display1.operation.charAt(i) =='^'
                ){
                    index=i;
                }else {
                    break;
                }
            }
        }
        else{
            return;
        }

        radicand=display1.operation.substring(index,display1.operation.length);
        display1.operation = display1.operation.substring(0, index) + "sqrt(" + radicand + ")";
        radicand=radicand.replace(/\^2/g,"\u00b2");



        index=$('#display1').val().lastIndexOf(radicand);
        radicand=$('#display1').val().substring(index,$('#display1').val().length);

        $('#display1').val($('#display1').val().substring(0, index) + '\u221a' + radicand);

        evaluate();
        $('#display2').val(display1.evaluation);

    });

    $('#square').on('click',function () {
        display1.operation=display1.operation+"^2";
        $("#display1").val($('#display1').val()+'\u00b2');
        evaluate();
        $("#display2").val(display1.evaluation);
    });

    $('#clear').on('click', function () {
        display1.operation = "",
                display1.evaluation = "",
                $('#display1').val("");
        $('#display2').val("");
    });

    $('#backspace').on('click', function () {
        display1.operation = display1.operation.slice(0, display1.operation.length-1);
        $('#display1').val($('#display1').val().slice(0, $('#display1').val().length-1));
        evaluate();
        $('#display2').val(display1.evaluation);
    });

    $('#percentage').on('click', function () {

         $("#display2").val("功能还没有实现");

    });

    $("#equal").on('click',function () {
        display1.answer=display1.evaluation;
        $("#display2").val("");
        $("#display1").val(display1.answer);
        display1.operation=display1.answer;
        flag.ansAllowed=true;

    });

    $('#ans').on('click', function () {
        $("#display2").val("功能还没有实现");
    });


    $("input[type='checkbox']").change(function () {
        if (this.checked) {
            $(".container").removeClass("container-light");
            $(".container").addClass("container-dark");
            $("form").removeClass("form-light");
            $("form").addClass("form-dark");
            $("form input").removeClass("form-input-light");
            $("form input").addClass("form-input-dark");
            $(".operand-group").removeClass("operand-group-light");
            $(".operand-group").addClass("operand-group-dark");
            $(".operator-group").removeClass("operator-group-light");
            $(".operator-group").addClass("operator-group-dark");
            $("#equal").removeClass("equal-light");
            $("#equal").addClass("equal-dark");
            $("#clear").removeClass("clear-light");
            $("#clear").addClass("clear-dark");
            $("#backspace").removeClass("backspace-light");
            $("#backspace").addClass("backspace-dark");
        }

        else {
            $(".container").removeClass("container-dark");
            $(".container").addClass("container-light");
            $("form").removeClass("form-dark");
            $("form").addClass("form-light");
            $("form input").removeClass("form-input-dark");
            $("form input").addClass("form-input-light");
            $(".operand-group").removeClass("operand-group-dark");
            $(".operand-group").addClass("operand-group-light");
            $(".operator-group").removeClass("operator-group-dark");
            $(".operator-group").addClass("operator-group-light");
            $("#equal").removeClass("equal-dark");
            $("#equal").addClass("equal-light");
            $("#clear").removeClass("clear-dark");
            $("#clear").addClass("clear-light");
            $("#backspace").removeClass("backspace-dark");
            $("#backspace").addClass("backspace-light");
        }
    });

</script>
</body>
</html>